<!DOCTYPE html>
<html>
<head>
    <title>Hot/Cold Analysis Validator</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .result { padding: 10px; margin: 5px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .warning { background: #fff3cd; color: #856404; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .debug-output { background: #f8f9fa; padding: 10px; font-family: monospace; white-space: pre-wrap; max-height: 200px; overflow-y: auto; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f2f2f2; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• TOTO Hot/Cold Analysis Validator</h1>
        
        <div class="test-section">
            <h2>Configuration</h2>
            <div>
                <label>Base Numbers: </label>
                <input id="base1" value="16" style="width: 50px;">
                <input id="base2" value="22" style="width: 50px;">
                <input id="base3" value="10" style="width: 50px;">
            </div>
            <div style="margin: 10px 0;">
                <input id="includeAdd" type="checkbox"> Include Additional Numbers
            </div>
            <button onclick="runValidation()">üîç Run Hot/Cold Validation</button>
            <button onclick="clearResults()">üßπ Clear Results</button>
        </div>
        
        <div class="grid">
            <div class="test-section">
                <h3>üìä Range: 20 Draws</h3>
                <div id="results-20"></div>
            </div>
            <div class="test-section">
                <h3>üìä Range: 50 Draws</h3>
                <div id="results-50"></div>
            </div>
            <div class="test-section">
                <h3>üìä Range: 100 Draws</h3>
                <div id="results-100"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üìã Validation Summary</h2>
            <div id="summary"></div>
        </div>
        
        <div class="test-section">
            <h2>üîß Debug Output</h2>
            <div id="debug" class="debug-output"></div>
        </div>
        
        <div style="display: none;">
            <select id="drawRange">
                <option value="20">20 draws</option>
                <option value="50">50 draws</option>
                <option value="100">100 draws</option>
            </select>
        </div>
    </div>

    <!-- Include the main HTML content for historical data and functions -->
    <script>
        // Sample historical data (consistent with other validators)
        const sampleHistorical = [
            { numbers: [1, 12, 23, 34, 45, 49], additional: 7 },
            { numbers: [2, 13, 24, 35, 46, 48], additional: 8 },
            { numbers: [3, 14, 25, 36, 47, 40], additional: 9 },
            { numbers: [4, 15, 26, 37, 41, 42], additional: 10 },
            { numbers: [5, 16, 27, 38, 43, 44], additional: 11 },
            { numbers: [6, 17, 28, 39, 45, 46], additional: 12 },
            { numbers: [7, 18, 29, 40, 47, 48], additional: 13 },
            { numbers: [8, 19, 30, 41, 49, 1], additional: 14 },
            { numbers: [9, 20, 31, 42, 2, 3], additional: 15 },
            { numbers: [10, 21, 32, 43, 4, 5], additional: 16 },
            { numbers: [11, 22, 33, 44, 6, 7], additional: 17 },
            { numbers: [12, 23, 34, 45, 8, 9], additional: 18 },
            { numbers: [13, 24, 35, 46, 10, 11], additional: 19 },
            { numbers: [14, 25, 36, 47, 12, 13], additional: 20 },
            { numbers: [15, 26, 37, 48, 14, 15], additional: 21 },
            { numbers: [16, 27, 38, 49, 16, 17], additional: 22 },
            { numbers: [17, 28, 39, 1, 18, 19], additional: 23 },
            { numbers: [18, 29, 40, 2, 20, 21], additional: 24 },
            { numbers: [19, 30, 41, 3, 22, 23], additional: 25 },
            { numbers: [20, 31, 42, 4, 24, 25], additional: 26 }
        ];

        // Extend to 100 draws
        const historical = [...sampleHistorical];
        for (let i = 0; i < 80; i++) {
            const baseEntry = sampleHistorical[i % 20];
            const offset = Math.floor(i / 20) * 5;
            historical.push({
                numbers: baseEntry.numbers.map(n => ((n + offset - 1) % 49) + 1),
                additional: ((baseEntry.additional + offset - 1) % 49) + 1
            });
        }

        // Make historical globally available
        window.historical = historical;

        // Utility functions
        function getSelectedBases() {
            return [
                parseInt(document.getElementById('base1').value),
                parseInt(document.getElementById('base2').value),
                parseInt(document.getElementById('base3').value)
            ];
        }

        function getDrawRange() {
            return parseInt(document.getElementById('drawRange').value);
        }

        // Helper functions for Hot/Cold Analysis
        function identifyColdNumbers(includeAdd = false) {
            const recentDraws = historical.slice(0, Math.min(20, historical.length));
            const recentNumbers = new Set();
            
            recentDraws.forEach(draw => {
                const pool = includeAdd && draw.numbers.length === 6 ? draw.numbers.concat(draw.additional) : draw.numbers;
                pool.forEach(n => {
                    if (n >= 1 && n <= 49) recentNumbers.add(n);
                });
            });
            
            const coldNumbers = [];
            for (let n = 1; n <= 49; n++) {
                if (!recentNumbers.has(n)) {
                    coldNumbers.push(n);
                }
            }
            
            return coldNumbers;
        }

        function applyColdNumberAvoidance(candidates, coldNumbers, maxColdAllowed = 1) {
            const filtered = [];
            let coldCount = 0;
            
            for (const candidate of candidates) {
                if (coldNumbers.includes(candidate.n || candidate)) {
                    if (coldCount < maxColdAllowed) {
                        filtered.push(candidate);
                        coldCount++;
                    }
                } else {
                    filtered.push(candidate);
                }
            }
            
            return filtered;
        }

        // Test results storage
        const testResults = {};
        const debugMessages = [];

        // Override console.log to capture debug messages
        const originalConsoleLog = console.log;
        console.log = function(...args) {
            const message = args.join(' ');
            if (message.includes('Debug:')) {
                debugMessages.push(message);
                document.getElementById('debug').textContent += message + '\n';
            }
            originalConsoleLog(...args);
        };
    </script>
    
    <!-- Load the main index.html script content -->
    <script src="index.html" type="text/javascript"></script>
    
    <script>
        // Hot/Cold Analysis function (simplified version for testing)
        function runHotColdPrediction() {
            const bases = getSelectedBases();
            const range = getDrawRange();
            const includeAdd = false;
            
            const recentSize = Math.min(Math.max(10, Math.floor(range * 0.3)), 30);
            const recentDraws = historical.slice(0, Math.min(recentSize, historical.length));
            const historicalDraws = historical.slice(recentSize, Math.min(range + recentSize, historical.length));
            
            console.log('Debug: Hot/Cold using', recentDraws.length, 'recent vs', historicalDraws.length, 'historical draws');
            
            const recentFreq = Array(50).fill(0);
            const historicalFreq = Array(50).fill(0);
            
            // Count frequencies
            recentDraws.forEach(draw => {
                draw.numbers.forEach(n => {
                    if (n >= 1 && n <= 49) recentFreq[n]++;
                });
            });
            
            historicalDraws.forEach(draw => {
                draw.numbers.forEach(n => {
                    if (n >= 1 && n <= 49) historicalFreq[n]++;
                });
            });
            
            // Calculate suggestions
            const suggestions = recentFreq.map((recentCount, n) => {
                const recentRate = recentCount / recentDraws.length;
                const historicalRate = historicalFreq[n] / Math.max(1, historicalDraws.length);
                const hotRatio = historicalRate > 0 ? recentRate / historicalRate : (recentCount > 0 ? 10 : 0);
                
                let hotScore = 0;
                hotScore += recentCount * 0.25;
                
                if (hotRatio > 1.5 && recentRate > 0.10) {
                    hotScore += hotRatio * 0.40;
                }
                
                if (recentCount >= 3 && hotRatio > 1.2) {
                    hotScore += 0.20;
                }
                
                if (recentCount === 0 && historicalRate > 0.08) {
                    hotScore -= 0.15;
                }
                
                const rangeBonus = range <= 20 ? hotScore * 0.1 : range <= 50 ? hotScore * 0.05 : 0;
                hotScore += rangeBonus;
                
                return {
                    n,
                    recentCount,
                    recentRate: recentRate * 100,
                    historicalRate: historicalRate * 100,
                    hotRatio,
                    hotScore,
                    trend: recentCount > historicalFreq[n] / Math.max(1, historicalDraws.length) * recentDraws.length ? '+' : (recentCount === 0 ? '--' : '-'),
                    confidence: Math.min(95, 50 + hotScore * 20)
                };
            })
            .filter(o => o.n >= 1 && o.n <= 49 && !bases.includes(o.n))
            .sort((a, b) => b.hotScore - a.hotScore || a.n - b.n);
            
            // Filter and select
            const coldNumbers = identifyColdNumbers(includeAdd);
            const filteredSuggestions = applyColdNumberAvoidance(suggestions, coldNumbers, 1);
            
            const finalPredictions = [];
            let evenCount = 0, oddCount = 0;
            
            for (const candidate of filteredSuggestions) {
                if (finalPredictions.length >= 6) break;
                
                const isEven = candidate.n % 2 === 0;
                
                if ((isEven && evenCount < 3) || (!isEven && oddCount < 3) || 
                    (finalPredictions.length >= 4)) {
                    
                    finalPredictions.push(candidate);
                    if (isEven) evenCount++;
                    else oddCount++;
                }
            }
            
            // Fill remaining slots if needed
            if (finalPredictions.length < 6) {
                for (const candidate of filteredSuggestions) {
                    if (finalPredictions.length >= 6) break;
                    if (!finalPredictions.some(p => p.n === candidate.n)) {
                        finalPredictions.push(candidate);
                    }
                }
            }

            const scores = finalPredictions.map(o => o.hotScore);
            
            // Create temperature data
            const temperatureData = finalPredictions.map(prediction => {
                const temp = prediction.hotRatio > 1.5 ? 'hot' : 
                           prediction.hotRatio < 0.5 ? 'cold' : 'warm';
                return {
                    temperature: temp,
                    trend: prediction.hotRatio - 1.0
                };
            });

            console.log('Debug: Final predictions count:', finalPredictions.length);
            console.log('Debug: Final predictions numbers:', finalPredictions.map(p => p.n));
            console.log('Debug: Scores array:', scores.length);
            
            displayPredictedNumbers(
                finalPredictions.map(o => o.n), 
                null, 
                scores, 
                [], 
                [], 
                `Hot/Cold Analysis (${range} draws, Recent: ${recentDraws.length}, E/O: ${evenCount}/${oddCount})`,
                temperatureData
            );
        }

        // Custom display function to capture results
        function displayPredictedNumbers(numbers, additional, scores, freq, compat, title, extraData) {
            const range = getDrawRange();
            
            const result = {
                numbers: numbers,
                scores: scores,
                title: title,
                extraData: extraData,
                evenCount: numbers.filter(n => n % 2 === 0).length,
                oddCount: numbers.filter(n => n % 2 === 1).length,
                hasBaseNumbers: numbers.some(n => getSelectedBases().includes(n)),
                avgScore: scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0,
                minNumber: Math.min(...numbers),
                maxNumber: Math.max(...numbers),
                temperatureTypes: extraData ? extraData.map(d => d.temperature) : [],
                uniqueNumbers: new Set(numbers).size === numbers.length
            };
            
            testResults[range] = result;
            
            // Display results in the appropriate section
            displayRangeResult(range, result);
        }

        function displayRangeResult(range, result) {
            const container = document.getElementById(`results-${range}`);
            
            const validations = [
                { test: result.numbers.length === 6, name: '6 numbers', type: result.numbers.length === 6 ? 'success' : 'error' },
                { test: result.uniqueNumbers, name: 'All unique', type: result.uniqueNumbers ? 'success' : 'error' },
                { test: result.evenCount === 3 && result.oddCount === 3, name: 'Even/Odd 3/3', type: result.evenCount === 3 && result.oddCount === 3 ? 'success' : 'warning' },
                { test: !result.hasBaseNumbers, name: 'No base overlap', type: !result.hasBaseNumbers ? 'success' : 'warning' },
                { test: result.minNumber >= 1 && result.maxNumber <= 49, name: 'Range 1-49', type: result.minNumber >= 1 && result.maxNumber <= 49 ? 'success' : 'error' },
                { test: result.scores.length === 6, name: 'Score array', type: result.scores.length === 6 ? 'success' : 'error' },
                { test: result.extraData && result.extraData.length === 6, name: 'Temperature data', type: result.extraData && result.extraData.length === 6 ? 'success' : 'warning' }
            ];
            
            let html = `
                <div class="info">Numbers: [${result.numbers.join(', ')}]</div>
                <div class="info">Avg Score: ${result.avgScore.toFixed(2)}</div>
                <div class="info">Temperatures: ${result.temperatureTypes.join(', ')}</div>
            `;
            
            validations.forEach(v => {
                html += `<div class="${v.type}">${v.name}: ${v.test ? '‚úÖ' : '‚ùå'}</div>`;
            });
            
            container.innerHTML = html;
        }

        function runValidation() {
            // Clear previous results
            debugMessages.length = 0;
            document.getElementById('debug').textContent = '';
            
            console.log('üî• Starting Hot/Cold Analysis Validation...');
            
            try {
                // Test all ranges
                [20, 50, 100].forEach(range => {
                    document.getElementById('drawRange').value = range.toString();
                    runHotColdPrediction();
                });
                
                // Display summary
                setTimeout(displaySummary, 100);
                
            } catch (error) {
                console.error('Validation error:', error);
                document.getElementById('summary').innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        function displaySummary() {
            const summary = document.getElementById('summary');
            
            const ranges = [20, 50, 100];
            const allTested = ranges.every(r => testResults[r]);
            
            let html = '<table><tr><th>Range</th><th>Numbers</th><th>Even/Odd</th><th>Avg Score</th><th>Temperatures</th><th>Status</th></tr>';
            
            ranges.forEach(range => {
                const result = testResults[range];
                if (result) {
                    const status = result.numbers.length === 6 && result.uniqueNumbers && 
                                 result.evenCount === 3 && result.oddCount === 3 ? '‚úÖ' : '‚ö†Ô∏è';
                    
                    html += `
                        <tr>
                            <td>${range}</td>
                            <td>[${result.numbers.join(', ')}]</td>
                            <td>${result.evenCount}/${result.oddCount}</td>
                            <td>${result.avgScore.toFixed(2)}</td>
                            <td>${result.temperatureTypes.join(',')}</td>
                            <td>${status}</td>
                        </tr>
                    `;
                } else {
                    html += `<tr><td>${range}</td><td colspan="5">‚ùå Failed</td></tr>`;
                }
            });
            
            html += '</table>';
            
            // Overall assessment
            if (allTested) {
                html += '<div class="success">‚úÖ Hot/Cold Analysis validation completed successfully!</div>';
                html += '<div class="info">All ranges tested, proper number generation confirmed.</div>';
            } else {
                html += '<div class="error">‚ùå Some ranges failed validation</div>';
            }
            
            // Debug message summary
            html += `<div class="info">Debug messages captured: ${debugMessages.length}</div>`;
            
            summary.innerHTML = html;
        }

        function clearResults() {
            Object.keys(testResults).forEach(key => delete testResults[key]);
            debugMessages.length = 0;
            document.getElementById('debug').textContent = '';
            document.getElementById('summary').innerHTML = '';
            [20, 50, 100].forEach(range => {
                document.getElementById(`results-${range}`).innerHTML = '';
            });
        }
    </script>
</body>
</html>