<!DOCTYPE html>
<html>
<head>
    <title>TOTO Hot/Cold Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .results { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .debug { background: #f0f0f0; padding: 10px; font-family: monospace; white-space: pre-wrap; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>TOTO Hot/Cold Analysis Test</h1>
    
    <div>
        <label>Range: </label>
        <select id="drawRange">
            <option value="20">20 draws</option>
            <option value="50" selected>50 draws</option>
            <option value="100">100 draws</option>
        </select>
    </div>
    
    <div style="margin: 10px 0;">
        <input id="base1" value="16" style="width: 50px;">
        <input id="base2" value="22" style="width: 50px;">  
        <input id="base3" value="10" style="width: 50px;">
        <label>(Base numbers)</label>
    </div>
    
    <button onclick="testHotCold()">Test Hot/Cold Analysis</button>
    <button onclick="clearResults()">Clear</button>
    
    <div id="results" class="results"></div>
    <div id="debug" class="debug"></div>

    <script>
        // Sample historical data for testing
        const historical = [
            { numbers: [1, 12, 23, 34, 45, 49], additional: 7 },
            { numbers: [2, 13, 24, 35, 46, 48], additional: 8 },
            { numbers: [3, 14, 25, 36, 47, 40], additional: 9 },
            { numbers: [4, 15, 26, 37, 41, 42], additional: 10 },
            { numbers: [5, 16, 27, 38, 43, 44], additional: 11 },
            { numbers: [6, 17, 28, 39, 45, 46], additional: 12 },
            { numbers: [7, 18, 29, 40, 47, 48], additional: 13 },
            { numbers: [8, 19, 30, 41, 49, 1], additional: 14 },
            { numbers: [9, 20, 31, 42, 2, 3], additional: 15 },
            { numbers: [10, 21, 32, 43, 4, 5], additional: 16 },
            { numbers: [11, 22, 33, 44, 6, 7], additional: 17 },
            { numbers: [12, 23, 34, 45, 8, 9], additional: 18 },
            { numbers: [13, 24, 35, 46, 10, 11], additional: 19 },
            { numbers: [14, 25, 36, 47, 12, 13], additional: 20 },
            { numbers: [15, 26, 37, 48, 14, 15], additional: 21 },
            { numbers: [16, 27, 38, 49, 16, 17], additional: 22 },
            { numbers: [17, 28, 39, 1, 18, 19], additional: 23 },
            { numbers: [18, 29, 40, 2, 20, 21], additional: 24 },
            { numbers: [19, 30, 41, 3, 22, 23], additional: 25 },
            { numbers: [20, 31, 42, 4, 24, 25], additional: 26 }
        ];
        
        // Extend to 100 draws by repeating pattern
        for (let i = 0; i < 80; i++) {
            const baseEntry = historical[i % 20];
            const offset = Math.floor(i / 20) * 5;
            historical.push({
                numbers: baseEntry.numbers.map(n => ((n + offset - 1) % 49) + 1),
                additional: ((baseEntry.additional + offset - 1) % 49) + 1
            });
        }

        function getSelectedBases() {
            return [
                parseInt(document.getElementById('base1').value),
                parseInt(document.getElementById('base2').value),
                parseInt(document.getElementById('base3').value)
            ];
        }

        function getDrawRange() {
            return parseInt(document.getElementById('drawRange').value);
        }

        // Helper functions for Hot/Cold Analysis
        function identifyColdNumbers(includeAdd = false) {
            const recentDraws = historical.slice(0, Math.min(20, historical.length));
            const recentNumbers = new Set();
            
            recentDraws.forEach(draw => {
                const pool = includeAdd && draw.numbers.length === 6 ? draw.numbers.concat(draw.additional) : draw.numbers;
                pool.forEach(n => {
                    if (n >= 1 && n <= 49) recentNumbers.add(n);
                });
            });
            
            const coldNumbers = [];
            for (let n = 1; n <= 49; n++) {
                if (!recentNumbers.has(n)) {
                    coldNumbers.push(n);
                }
            }
            
            return coldNumbers;
        }

        function applyColdNumberAvoidance(candidates, coldNumbers, maxColdAllowed = 1) {
            const filtered = [];
            let coldCount = 0;
            
            for (const candidate of candidates) {
                if (coldNumbers.includes(candidate.n || candidate)) {
                    if (coldCount < maxColdAllowed) {
                        filtered.push(candidate);
                        coldCount++;
                    }
                } else {
                    filtered.push(candidate);
                }
            }
            
            return filtered;
        }

        function displayPredictedNumbers(numbers, additional, scores, freq, compat, title, extraData) {
            const resultsDiv = document.getElementById('results');
            
            const html = `
                <h3>${title}</h3>
                <div style="font-size: 18px; font-weight: bold; color: #0066cc;">
                    Numbers: ${numbers.join(', ')}
                </div>
                <div style="margin-top: 10px; font-size: 14px; color: #666;">
                    Scores: ${scores.map(s => s.toFixed(2)).join(', ')}
                </div>
                ${extraData ? `<div style="margin-top: 5px; font-size: 12px;">
                    Temperatures: ${extraData.map(d => d.temperature).join(', ')}
                </div>` : ''}
            `;
            
            resultsDiv.innerHTML = html;
        }

        // Override console.log to show debug info
        const debugDiv = document.getElementById('debug');
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog(...args);
            debugDiv.textContent += args.join(' ') + '\\n';
        };

        function testHotCold() {
            debugDiv.textContent = '';
            console.log('Starting Hot/Cold Analysis test...');
            console.log('Historical data available:', historical.length, 'draws');
            
            try {
                runHotColdPrediction();
                console.log('Test completed successfully!');
            } catch (error) {
                console.log('ERROR:', error.message);
                console.log(error.stack);
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('debug').textContent = '';
        }

        // Include Hot/Cold Analysis function
        function runHotColdPrediction() {
            const bases = getSelectedBases();
            const range = getDrawRange();
            const includeAdd = false;
            
            const recentSize = Math.min(Math.max(10, Math.floor(range * 0.3)), 30);
            const recentDraws = historical.slice(0, Math.min(recentSize, historical.length));
            const historicalDraws = historical.slice(recentSize, Math.min(range + recentSize, historical.length));
            
            console.log('Debug: Hot/Cold using', recentDraws.length, 'recent vs', historicalDraws.length, 'historical draws');
            
            const recentFreq = Array(50).fill(0);
            const historicalFreq = Array(50).fill(0);
            
            // Count recent frequencies
            recentDraws.forEach(draw => {
                const pool = includeAdd && draw.numbers.length === 6 ? draw.numbers.concat(draw.additional) : draw.numbers;
                pool.forEach(n => {
                    if (n >= 1 && n <= 49) recentFreq[n]++;
                });
            });
            
            // Count historical frequencies  
            historicalDraws.forEach(draw => {
                const pool = includeAdd && draw.numbers.length === 6 ? draw.numbers.concat(draw.additional) : draw.numbers;
                pool.forEach(n => {
                    if (n >= 1 && n <= 49) historicalFreq[n]++;
                });
            });
            
            // Calculate hotness ratios and scores
            const suggestions = recentFreq.map((recentCount, n) => {
                const recentRate = recentCount / recentDraws.length;
                const historicalRate = historicalFreq[n] / Math.max(1, historicalDraws.length);
                const hotRatio = historicalRate > 0 ? recentRate / historicalRate : (recentCount > 0 ? 10 : 0);
                
                let hotScore = 0;
                hotScore += recentCount * 0.25;
                
                if (hotRatio > 1.5 && recentRate > 0.10) {
                    hotScore += hotRatio * 0.40;
                }
                
                if (recentCount >= 3 && hotRatio > 1.2) {
                    hotScore += 0.20;
                }
                
                if (recentCount === 0 && historicalRate > 0.08) {
                    hotScore -= 0.15;
                }
                
                const rangeBonus = range <= 20 ? hotScore * 0.1 : range <= 50 ? hotScore * 0.05 : 0;
                hotScore += rangeBonus;
                
                return {
                    n,
                    recentCount,
                    recentRate: recentRate * 100,
                    historicalRate: historicalRate * 100,
                    hotRatio,
                    hotScore,
                    trend: recentCount > historicalFreq[n] / Math.max(1, historicalDraws.length) * recentDraws.length ? '+' : (recentCount === 0 ? '--' : '-'),
                    confidence: Math.min(95, 50 + hotScore * 20)
                };
            })
            .filter(o => o.n >= 1 && o.n <= 49 && !bases.includes(o.n))
            .sort((a, b) => b.hotScore - a.hotScore || a.n - b.n);
            
            // Filter candidates
            const coldNumbers = identifyColdNumbers(includeAdd);
            const filteredSuggestions = applyColdNumberAvoidance(suggestions, coldNumbers, 1);
            
            // Smart selection with even/odd balance
            const finalPredictions = [];
            let evenCount = 0, oddCount = 0;
            
            for (const candidate of filteredSuggestions) {
                if (finalPredictions.length >= 6) break;
                
                const isEven = candidate.n % 2 === 0;
                
                if ((isEven && evenCount < 3) || (!isEven && oddCount < 3) || 
                    (finalPredictions.length >= 4)) {
                    
                    finalPredictions.push(candidate);
                    if (isEven) evenCount++;
                    else oddCount++;
                }
            }
            
            // Fill remaining slots if needed
            if (finalPredictions.length < 6) {
                for (const candidate of filteredSuggestions) {
                    if (finalPredictions.length >= 6) break;
                    if (!finalPredictions.some(p => p.n === candidate.n)) {
                        finalPredictions.push(candidate);
                    }
                }
            }

            const scores = finalPredictions.map(o => o.hotScore);
            
            // Calculate analytics data
            const freq = Array(50).fill(0);
            const compat = Array(50).fill(0);
            
            historical.slice(0, range).forEach(draw => {
                const pool = includeAdd ? draw.numbers.concat(draw.additional) : draw.numbers;
                pool.forEach(n => freq[n]++);
                bases.forEach(b => {
                    if (pool.includes(b)) {
                        pool.filter(n => n !== b).forEach(n => compat[n]++);
                    }
                });
            });
            
            // Create temperature data for display
            const temperatureData = finalPredictions.map(prediction => {
                const temp = prediction.hotRatio > 1.5 ? 'hot' : 
                           prediction.hotRatio < 0.5 ? 'cold' : 'warm';
                return {
                    temperature: temp,
                    trend: prediction.hotRatio - 1.0
                };
            });

            console.log('Debug: Hot/Cold predictions with heat ratios:', 
              finalPredictions.map(p => `${p.n}(${p.trend}, ${p.recentRate.toFixed(1)}%)`).join(', '));
            console.log('Debug: Even/Odd balance:', evenCount, '/', oddCount);
            console.log('Debug: Final predictions count:', finalPredictions.length);
            console.log('Debug: Final predictions numbers:', finalPredictions.map(p => p.n));
            console.log('Debug: Scores array:', scores);
            
            displayPredictedNumbers(
                finalPredictions.map(o => o.n), 
                null, 
                scores, 
                freq, 
                compat, 
                `Hot/Cold Number Analysis (Recent: ${recentDraws.length}, E/O: ${evenCount}/${oddCount})`,
                temperatureData
            );
        }
    </script>
</body>
</html>